<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0          http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd">
    <camelContext id="camelContext-28132684-f68b-4187-be20-8c99e774585b" xmlns="http://camel.apache.org/schema/blueprint">
        <route id="get">
            <from id="from2" uri="amqComponent:queue:test.sks"/>
            <log id="log3" message="GOT MESSAGE"/>
            <to id="to1" uri="jms:queue:jms/sks"/>
        </route>
    </camelContext>
    <bean class="org.apache.activemq.pool.PooledConnectionFactory" id="jmsPoolConnectionFactory">
        <property name="maxConnections" value="1"/>
        <property name="connectionFactory" ref="amqConnectionFactory"/>
    </bean>
    <bean class="org.apache.activemq.camel.component.ActiveMQComponent" id="amqComponent">
        <property name="connectionFactory" ref="jmsPoolConnectionFactory"/>
        <property name="acceptMessagesWhileStopping" value="false"/>
        <property name="alwaysCopyMessage" value="true"/>
        <property name="userName" value="admin"/>
        <property name="password" value="admin"/>
        <property name="cacheLevelName" value="CACHE_NONE"/>
    </bean>
    <bean class="org.apache.activemq.ActiveMQConnectionFactory" id="amqConnectionFactory">
        <property name="brokerURL">
            <value>tcp://localhost:61616</value>
        </property>
        <property name="userName" value="admin"/>
        <property name="password" value="admin"/>
    </bean>
    <bean class="org.springframework.jndi.JndiTemplate" id="jndiTemplate">
        <property name="environment">
            <props>
                <prop key="java.naming.factory.initial">org.jboss.naming.remote.client.InitialContextFactory</prop>
                <prop key="java.naming.provider.url">http-remoting://localhost:8080</prop>
                <prop key="java.naming.security.principal">jms</prop>
                <prop key="java.naming.security.credentials">jms@1234</prop>
                <prop key="jboss.naming.client.remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED">true</prop>
                <prop key="jboss.naming.client.connect.options.org.xnio.Options.SSL_POLICY_NOANONYMOUS">true</prop>
            </props>
        </property>
    </bean>
    <bean factory-method="createJndiObjectFactory" factory-ref="factory"
        id="jmsInConnectionFactoryJndiLookupFactory" init-method="afterPropertiesSet">
        <property name="jndiTemplate" ref="jndiTemplate"/>
        <property name="jndiName" value="jms/RemoteConnectionFactory"/>
        <property name="proxyInterface" value="javax.jms.ConnectionFactory"/>
    </bean>
    <bean factory-method="getObject"
        factory-ref="jmsInConnectionFactoryJndiLookupFactory" id="JmsConnectionFactory"/>
    <bean class="org.apache.camel.component.jms.JmsComponent" id="jms">
        <property name="connectionFactory" ref="JmsConnectionFactory"/>
    </bean>
    <bean class="com.test.JndiFactoryFactory"
        destroy-method="destroyJndiObjectFactory" id="factory"/>
</blueprint>
